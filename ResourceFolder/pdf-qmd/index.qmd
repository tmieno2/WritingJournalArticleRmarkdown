---
title: Paper Title
format: 
  pdf:
    toc: false
    number-sections: true
    number-depth: 2
    colorlinks: true
    keep-tex: true
    fontfamily: times
    fig-cap-location: bottom
    tbl-cap-location: top
    include-in-header:
      - file: preamble.tex
author:
  - name: John Doe
    orcid: 9999-9999-9999-9999
    corresponding: true
    email: johndoe@corps.com
    roles:
      - Investigation
      - Project administration
      - Software
      - Visualization
    affiliations:
      - Curvenote
  - name: Jeanne Doe
    orcid: 1111-1111-1111-1111
    corresponding: false
    roles:
      - Analysis
    affiliations:
      - Curvenote
license: CC BY-SA 4.0
keywords:
  - Repoducible
  - R
date: '2023-09-24'
abstract: |
  Abstract: this research is so awesome that you cannot reject this paper.
keypoints:
  - qmd to pdf is pretty straightforward
  - no more key points
citation:
  container-title: sample
draft: false
bibliography: bibliography.bib
echo: false
csl: qje.csl
---

```{r}
#| include: false
library(knitr)
opts_chunk$set(
  fig.align = "center",
  fig.retina = 5,
  warning = FALSE,
  message = FALSE,
  cache = FALSE,
  echo = FALSE
)

library(tidyverse)
library(data.table)
library(modelsummary)
```

```{r }
#| eval: false
#|
# This is for you to set working directory easily. This serves no purpose in knitting to a manuscript
setwd("/Users/tmieno2/Dropbox/TeachingUNL/DataScience/LectureNotes/Chapter-9-WritingArticle")
```

```{r}
#--- read the regression data ---#
reg_data <-
  readRDS("reg_data.rds") %>%
  .[, Zone := case_when(
    tgt_comb == "36-124" ~ "Zone 3",
    tgt_comb == "34-134" ~ "Zone 2",
  )] %>%
  filter(!is.na(Zone))
```

# Introduction

The issue this article addresses is **super** *important*!

-   **author names and year**: @schlenker2009nonlinear examined ....

-   **author names and year in parentheses**: [@schlenker2009nonlinear]

-   **multiple citations in parentheses**: [@schlenker2009nonlinear; @mas1995microeconomic]

-   **only year in parentheses**: [-@schlenker2009nonlinear]


\newpage

# Materials and Methods

## Data

```{r}
#--- number of observations by zone ---#
num_obs <-
  reg_data %>%
  group_by(Zone) %>%
  summarize(n = n())

num_obs_z2 <- filter(num_obs, Zone == "Zone 2")$n
num_obs_z3 <- filter(num_obs, Zone == "Zone 3")$n
```

The number of observations are `r num_obs_z2` and `r num_obs_z3` for Zones 2 and 3, respectively.

Table @tbl-summary-statistics presents summary statistics by zone.

## Statistical Model

See equation \ref{eq1} and \ref{eq2} for the statistical models we use.

\begin{equation}
y = \beta_0 + \beta_1 x + \varepsilon \label{eq1}
\end{equation}

\begin{align}
Y_z & = f_z(S) + g_z(N) + h_z(X,Y) + \varepsilon_z \notag \\
& = \sum_{i=1}^k \phi_k(S) + g_z(N) + h_z(X,Y) + \varepsilon_z \label{eq2}
\end{align}

Our target coefficient is $\beta_1$ (in-line math).

# Results and Discussions

Table @tbl-reg-table presents the regression results.

Figure @fig-yield-dist presents the distribution of yields by zone.

# Conclusions

bluh bluh^[This is a footnote], another bluh bluh^[This is the second footnote]

# Figures

I like @fig-yield-dist a lot.

```{r}
#| label: "fig-yield-dist"
#| fig-cap: "The Distribution of Yield by Zone" 
#| out-width: 80%
#| out-height: 80% # this does not have any effect
g_plot <-
  ggplot() +
  geom_density(
    data = reg_data,
    aes(
      x = Yield,
      fill = Zone,
      alpha = 0.3
    )
  )

g_plot
```

```{r}
ggsave(filename = "g_plot_external.pdf", g_plot, width = 6, height = 3)
```

Figure @fig-imported-plot was imported. 

When width or height is not specified, the original dimension of the saved figure is respected.

```{r}
#| label: fig-imported-plot
#| fig.cap: "Imported Plot"
knitr::include_graphics("g_plot_external.pdf")
```


# Tables

## Use the `modelsummary` package to create regression results tables

```{r}
#| label: tbl-reg-table
#| tbl-cap: "Regression results table by the modelsummary function" 
#--- regressions ---#
lm_1 <- fixest::feols(mpg ~ hp + cyl, data = mtcars)
lm_2 <- fixest::feols(mpg ~ hp + cyl + wt, data = mtcars)
lm_3 <- fixest::feols(mpg ~ hp + cyl + wt, cluster = ~ vs, data = mtcars)

#--- create a regression results table ---#
modelsummary::modelsummary(
  list(lm_1, lm_2, lm_3),
  output = "flextable",
  gof_omit = "IC|Log|Adj|F|Pseudo|Within"
)
```

Table @tbl-reg-table shows the regression results.

```{r, }
#| label: tbl-summary-statistics
#| tbl-cap: "Summary Statistics by Zone"
#--- find observations ---#
# write the function that forces the number of observations to be presented as integers
get_N <- function(x) {
  length(x) %>% as.integer()
}

#--- create a summary table by zone ---#
summary_table <-
  reg_data %>%
  datasummary(
    Zone * (
      (`Yield (kg/ha)` = Yield) +
        (`Nitrogen Rate (kg/ha)` = aa_n) +
        (`Seed Rate (1000/ha)` = aa_s)
    ) ~
      Format(digits = 1) * get_N + Mean + SD + Min + Max,
    data = .,
    output = "flextable"
  )

summary_table
```

Table @tbl-summary-statistics shows summary statistics.

## The `gt` package works as well

```{r}
#| label: tbl-from-gt
#| tbl-cap: "A table created by the gt package" 
library(gt)
(
  tab_1 <-
    exibble %>%
    gt(
      rowname_col = "row",
      groupname_col = "group"
    )
)
```

\newpage

# Appendix

itemized list (this does not work)
+ item 1
+ item 2
+ item 3


itemized list

+ item 1
+ item 2
+ item 3

nested list

+ item 1
  - item 1.1 
  - item 1.2 
+ item 2
+ item 3

enumerated list

1. item 1
2. item 2
3. item 3

\newpage

# References

